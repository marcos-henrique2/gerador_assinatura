{% extends 'base.html' %} {% block content %}
<h2 class="text-center mb-4">Assinatura Gerada com Sucesso!</h2>
<p class="text-center text-muted">
  Clique no botão abaixo para copiar a assinatura. Depois, cole (Ctrl+V) na
  configuração do seu cliente de e-mail.
</p>
<hr />

<div
  id="assinatura"
  style="
    border: 1px dashed #ccc;
    padding: 20px;
    font-family: Arial, sans-serif;
    font-size: 10pt;
  "
>
  <table
    border="0"
    cellpadding="0"
    cellspacing="0"
    style="font-family: Arial, sans-serif; font-size: 10pt; color: #333"
  >
    <tr>
      <td style="padding-right: 15px">
        {% if logo_base64 %}
        <img
          src="data:image/png;base64,{{ logo_base64 }}"
          alt="Logo da Empresa"
          width="150"
        />
        {% endif %}
      </td>

      <td style="padding-left: 15px">
        <strong style="color: #0055a5; font-size: 11pt"
          >{{ dados['nome'] }}</strong
        ><br />
        <span style="font-style: italic">{{ dados['cargo'] }}</span><br />
        <span>{{ dados['departamento'] }}</span><br />
        <strong style="color: #0055a5"
          >{{ dados['concessionaria_selecionada'] }}</strong
        ><br />
        <span>{{ dados['endereco'] }}</span><br />
        <span>{{ dados['cidade'] }} - CEP: {{ dados['cep'] }}</span><br />
        <span>Telefone: {{ dados['telefone'] }}</span><br />
        <a
          href="mailto:{{ dados['email'] }}"
          style="color: #333; text-decoration: none"
          >{{ dados['email'] }}</a
        ><br />
        <a
          href="http://{{ dados['site'] }}"
          target="_blank"
          style="color: #0055a5; text-decoration: none"
          >{{ dados['site'] }}</a
        >
      </td>
    </tr>
  </table>
</div>

<div class="mt-4">
  <button id="btn-copiar" class="btn btn-success btn-block">
    <i class="fas fa-copy"></i> Copiar Assinatura
  </button>
  <a href="{{ url_for('index') }}" class="btn btn-secondary btn-block mt-2"
    >← Gerar Outra Assinatura</a
  >
</div>

<script>
  // 1. Pega os elementos HTML com os quais vamos interagir.
  const btnCopiar = document.getElementById("btn-copiar");
  const divAssinatura = document.getElementById("assinatura");

  // 2. Adiciona um "escutador" de evento de clique ao botão.
  btnCopiar.addEventListener("click", function () {
    // Pega todo o conteúdo HTML de dentro da div da assinatura.
    const htmlParaCopiar = divAssinatura.innerHTML;

    // Usa a API moderna do navegador para copiar conteúdo rico (HTML).
    try {
      const blob = new Blob([htmlParaCopiar], { type: "text/html" });
      const clipboardItem = new ClipboardItem({ "text/html": blob });

      navigator.clipboard
        .write([clipboardItem])
        .then(function () {
          // Feedback visual para o usuário
          const textoOriginal = btnCopiar.innerHTML;
          btnCopiar.innerHTML = "Copiado com sucesso! ✅";
          btnCopiar.classList.remove("btn-success");
          btnCopiar.classList.add("btn-light");

          // Volta ao normal depois de 3 segundos
          setTimeout(function () {
            btnCopiar.innerHTML = textoOriginal;
            btnCopiar.classList.remove("btn-light");
            btnCopiar.classList.add("btn-success");
          }, 3000);
        })
        .catch(function (err) {
          console.error("Falha ao copiar HTML: ", err);
          alert("Não foi possível copiar a assinatura.");
        });
    } catch (e) {
      console.error("Erro de compatibilidade com a API de Clipboard: ", e);
      alert("Seu navegador pode não suportar esta funcionalidade.");
    }
  });
</script>

{% endblock %}
